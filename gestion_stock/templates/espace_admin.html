{% extends "base.html" %}
{% load static %}

{% block title %}{{ titre_espace }} - SuccessFuel{% endblock %}

{% block sidebar_nav %}
<!-- Navigation spécifique pour l'administrateur de compagnie -->
<a href="#" class="nav-item active" onclick="showSection('dashboard-section')">
  <i class="fa-solid fa-chart-line"></i>
  <span>Dashboard</span>
</a>
<a href="#" class="nav-item" onclick="showSection('carburants-section')">
  <i class="fa-solid fa-gas-pump"></i>
  <span>Carburants</span>
</a>
<a href="#" class="nav-item" onclick="showSection('lubrifiants-section')">
  <i class="fa-solid fa-oil-can"></i>
  <span>Lubrifiants</span>
</a>
<a href="#" class="nav-item" onclick="showSection('stations-section')">
  <i class="fa-solid fa-building"></i>
  <span>Stations</span>
</a>
<a href="#" class="nav-item">
  <i class="fa-solid fa-chart-bar"></i>
  <span>Rapports</span>
</a>
<a href="#" class="nav-item">
  <i class="fa-solid fa-gear"></i>
  <span>Paramètres</span>
</a>
{% endblock %}

{% block content %}
<!-- Tableau de bord -->
<div id="dashboard-section" class="section-content">
  <!-- Stats Section -->
  <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">Statistiques de la compagnie</h2>
  <div class="grid grid-cols-4 mb-6">
    <div class="stat-card">
      <div class="stat-icon primary">
        <i class="fa-solid fa-building"></i>
      </div>
      <div class="stat-value">24</div>
      <div class="stat-label">Total Stations</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon secondary">
        <i class="fa-solid fa-euro-sign"></i>
      </div>
      <div class="stat-value">1.2M €</div>
      <div class="stat-label">CA Mensuel</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon accent">
        <i class="fa-solid fa-percentage"></i>
      </div>
      <div class="stat-value">12.5%</div>
      <div class="stat-label">Marge Moyenne</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon purple">
        <i class="fa-solid fa-bell"></i>
      </div>
      <div class="stat-value">5</div>
      <div class="stat-label">Alertes</div>
    </div>
  </div>

  <!-- Charts Section -->
  <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">Graphiques</h2>
  <div class="grid grid-cols-2">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Évolution des Ventes</h3>
        <p class="card-description">Analyse des tendances sur 6 mois</p>
      </div>
      <canvas id="salesChart" style="max-height: 300px;"></canvas>
    </div>

    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Évolution des Achats</h3>
        <p class="card-description">Analyse des tendances sur 6 mois</p>
      </div>
      <canvas id="purchaseChart" style="max-height: 300px;"></canvas>
    </div>
  </div>
</div>

<!-- Carburants -->
<div id="carburants-section" class="section-content" style="display: none;">
  <!-- Stats Section -->
  <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">Statistiques Carburants</h2>
  <div class="grid grid-cols-4 mb-6">
    <div class="stat-card">
      <div class="stat-icon primary">
        <i class="fa-solid fa-water"></i>
      </div>
      <div class="stat-value">120,000 L</div>
      <div class="stat-label">Volume Total</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon secondary">
        <i class="fa-solid fa-bolt"></i>
      </div>
      <div class="stat-value">48,560 L</div>
      <div class="stat-label">Ventes 24h</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon accent">
        <i class="fa-solid fa-chart-column"></i>
      </div>
      <div class="stat-value">72%</div>
      <div class="stat-label">Stock Moyen</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon purple">
        <i class="fa-solid fa-bell"></i>
      </div>
      <div class="stat-value">3</div>
      <div class="stat-label">Alertes</div>
    </div>
  </div>

  <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">Cuves de Carburants</h2>
  <div class="grid grid-cols-3">
    <div class="stat-card">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="card-title">Essence</h3>
        <span class="stat-value">85%</span>
      </div>
      <div class="tank-visual mb-3" style="position: relative; height: 192px; background-color: #E2E8F0; border-radius: 0.5rem; overflow: hidden;">
        <div class="tank-fill" style="position: absolute; bottom: 0; width: 100%; height: 85%; background-color: #3b82f6; border-radius: 0.5rem 0.5rem 0 0;"></div>
      </div>
      <div class="text-muted small">
        17,000L | 24°C
      </div>
      <div class="mt-3">
        <a href="#" class="btn btn-outline">Détails</a>
      </div>
    </div>

    <div class="stat-card">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="card-title">Gasoil</h3>
        <span class="stat-value">60%</span>
      </div>
      <div class="tank-visual mb-3" style="position: relative; height: 192px; background-color: #E2E8F0; border-radius: 0.5rem; overflow: hidden;">
        <div class="tank-fill" style="position: absolute; bottom: 0; width: 100%; height: 60%; background-color: #f59e0b; border-radius: 0.5rem 0.5rem 0 0;"></div>
      </div>
      <div class="text-muted small">
        12,000L | 23°C
      </div>
      <div class="mt-3">
        <a href="#" class="btn btn-outline">Détails</a>
      </div>
    </div>

    <div class="stat-card">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="card-title">Pétrole</h3>
        <span class="stat-value">35%</span>
      </div>
      <div class="tank-visual mb-3" style="position: relative; height: 192px; background-color: #E2E8F0; border-radius: 0.5rem; overflow: hidden;">
        <div class="tank-fill" style="position: absolute; bottom: 0; width: 100%; height: 35%; background-color: #ef4444; border-radius: 0.5rem 0.5rem 0 0;"></div>
      </div>
      <div class="text-muted small">
        7,000L | 25°C
      </div>
      <div class="mt-3">
        <a href="#" class="btn btn-outline">Détails</a>
      </div>
    </div>
  </div>
</div>

<!-- Lubrifiants -->
<div id="lubrifiants-section" class="section-content" style="display: none;">
  <!-- Stats Section -->
  <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">Statistiques Lubrifiants</h2>
  <div class="grid grid-cols-4 mb-6">
    <div class="stat-card">
      <div class="stat-icon primary">
        <i class="fa-solid fa-boxes-stacked"></i>
      </div>
      <div class="stat-value">86</div>
      <div class="stat-label">Produits Disponibles</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon secondary">
        <i class="fa-solid fa-euro-sign"></i>
      </div>
      <div class="stat-value">480K €</div>
      <div class="stat-label">Valeur Stock</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon accent">
        <i class="fa-solid fa-triangle-exclamation"></i>
      </div>
      <div class="stat-value">7</div>
      <div class="stat-label">Produits Bas Stock</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon purple">
        <i class="fa-solid fa-repeat"></i>
      </div>
      <div class="stat-value">2.1x</div>
      <div class="stat-label">Rotation Stock</div>
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">Lubrifiants</h2>
    <div class="flex gap-2">
      <button class="btn btn-outline active" onclick="showLubSubSection('liste')">Liste</button>
      <button class="btn btn-outline" onclick="showLubSubSection('recherche')">Recherche</button>
    </div>
  </div>

  <div id="liste-lubrifiants">
    <div class="card">
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>Produit</th>
              <th>Unité</th>
              <th>Stock Actuel</th>
              <th>Seuil Min</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Huile moteur 15W40</td>
              <td>Carton (12 bidons)</td>
              <td>15</td>
              <td>5</td>
              <td><span class="badge badge-success">Normal</span></td>
              <td>
                <button class="btn btn-outline">Détails</button>
              </td>
            </tr>
            <tr>
              <td>Liquide frein DOT4</td>
              <td>Bidon (1L)</td>
              <td>28</td>
              <td>10</td>
              <td><span class="badge badge-success">Normal</span></td>
              <td>
                <button class="btn btn-outline">Détails</button>
              </td>
            </tr>
            <tr>
              <td>Liquide refroidissement</td>
              <td>Seau (5L)</td>
              <td>3</td>
              <td>5</td>
              <td><span class="badge badge-warning">Bas</span></td>
              <td>
                <button class="btn btn-outline">Détails</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="recherche-lubrifiants" style="display: none;">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Recherche de lubrifiants</h3>
      </div>
      <div class="card-body">
        <form>
          <div class="form-group">
            <label class="form-label">Nom du produit</label>
            <input type="text" class="form-control" placeholder="Rechercher un lubrifiant...">
          </div>
          <div class="form-group">
            <label class="form-label">Catégorie</label>
            <select class="form-control">
              <option>Toutes catégories</option>
              <option>Huiles moteur</option>
              <option>Liquides techniques</option>
              <option>Autres</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Rechercher</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Stations Section -->
<div id="stations-section" class="section-content" style="display: none;">
  <!-- Stats Section -->
  <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">Statistiques Stations</h2>
  <div class="grid grid-cols-4 mb-6">
    <div class="stat-card">
      <div class="stat-icon primary">
        <i class="fa-solid fa-building"></i>
      </div>
      <div class="stat-value">24</div>
      <div class="stat-label">Total Stations</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon secondary">
        <i class="fa-solid fa-euro-sign"></i>
      </div>
      <div class="stat-value">1.2M €</div>
      <div class="stat-label">CA Total</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon accent">
        <i class="fa-solid fa-chart-simple"></i>
      </div>
      <div class="stat-value">50K €</div>
      <div class="stat-label">Moyenne/Station</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon purple">
        <i class="fa-solid fa-bell"></i>
      </div>
      <div class="stat-value">5</div>
      <div class="stat-label">Alertes</div>
    </div>
  </div>

  <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">Stations de la Compagnie</h2>
  <div class="grid grid-cols-3">
    {% if stations %}
      {% for station in stations %}
        <div class="tank-card">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="card-title">{{ station.nom }}</h3>
            <span class="stat-value">Opérationnel</span>
          </div>
          <div class="text-muted small mb-2">
            <i class="fa-solid fa-location-dot"></i>
            Antananarivo
          </div>
          <div class="text-muted small">
            <i class="fa-solid fa-user"></i>
            {{ station.gérant.prenom|default:"Jean" }} {{ station.gérant.nom|default:"Dupont" }}
          </div>
          <div class="mt-3">
            <a href="#" class="btn btn-outline">Détails</a>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="alert alert-info">
        <i class="fa-solid fa-info-circle"></i>
        <div>
          <strong>Aucune station</strong>
          <p>Aucune station trouvée pour cette compagnie.</p>
        </div>
      </div>
    {% endif %}
  </div>
</div>

<!-- Quick Actions Section -->
<h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">Actions Administratives</h2>
<div class="grid grid-cols-4">
  <a href="#" class="card action-btn">
    <div class="stat-icon primary">
      <i class="fa-solid fa-plus"></i>
    </div>
    <h3 class="card-title">Ajouter Station</h3>
  </a>

  <a href="#" class="card action-btn">
    <div class="stat-icon secondary">
      <i class="fa-solid fa-users"></i>
    </div>
    <h3 class="card-title">Gérer Utilisateurs</h3>
  </a>

  <a href="#" class="card action-btn">
    <div class="stat-icon accent">
      <i class="fa-solid fa-chart-line"></i>
    </div>
    <h3 class="card-title">Rapports</h3>
  </a>

  <a href="#" class="card action-btn">
    <div class="stat-icon purple">
      <i class="fa-solid fa-gear"></i>
    </div>
    <h3 class="card-title">Paramètres</h3>
  </a>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
  // Fonction pour afficher/masquer les sections
  function showSection(sectionId) {
    // Masquer toutes les sections
    document.querySelectorAll('.section-content').forEach(section => {
      section.style.display = 'none';
    });

    // Afficher la section demandée
    document.getElementById(sectionId).style.display = 'block';

    // Mettre à jour les classes actives dans la sidebar
    document.querySelectorAll('.nav-item').forEach(item => {
      item.classList.remove('active');
    });

    // Trouver le lien correspondant dans la sidebar et l'activer
    const sectionName = sectionId.replace('-section', '');
    const navItem = document.querySelector(`[onclick="showSection('${sectionName}-section')"]`);
    if (navItem) {
      navItem.classList.add('active');
    } else {
      // Si aucun lien spécifique n'est trouvé, activer le tableau de bord par défaut
      const dashboardLink = document.querySelector('[onclick="showSection(\'dashboard-section\')"]');
      if (dashboardLink) {
        dashboardLink.classList.add('active');
      }
    }
  }

  // Fonction pour afficher les sous-sections de lubrifiants
  function showLubSubSection(subSectionId) {
    // Masquer toutes les sous-sections
    document.getElementById('liste-lubrifiants').style.display = 'none';
    document.getElementById('recherche-lubrifiants').style.display = 'none';

    // Afficher la sous-section demandée
    if (subSectionId === 'liste') {
      document.getElementById('liste-lubrifiants').style.display = 'block';
      document.querySelector('#lubrifiants-section .btn-outline:nth-child(1)').classList.add('active');
      document.querySelector('#lubrifiants-section .btn-outline:nth-child(2)').classList.remove('active');
    } else if (subSectionId === 'recherche') {
      document.getElementById('recherche-lubrifiants').style.display = 'block';
      document.querySelector('#lubrifiants-section .btn-outline:nth-child(2)').classList.add('active');
      document.querySelector('#lubrifiants-section .btn-outline:nth-child(1)').classList.remove('active');
    }
  }

  // Animation des cuves au chargement
  document.addEventListener('DOMContentLoaded', function() {
    // Par défaut, afficher la section tableau de bord
    showSection('dashboard-section');

    const tankFills = document.querySelectorAll('.tank-fill');
    tankFills.forEach(fill => {
      const height = fill.style.height;
      fill.style.height = '0%';
      setTimeout(() => {
        fill.style.height = height;
      }, 100);
    });
  });
  
  // Initialisation des graphiques
  document.addEventListener('DOMContentLoaded', function() {
    // Graphique des ventes
    const salesCtx = document.getElementById('salesChart');
    if (salesCtx) {
      const salesChart = new Chart(salesCtx.getContext('2d'), {
        type: 'line',
        data: {
          labels: ['Août', 'Sept', 'Oct', 'Nov', 'Déc', 'Jan'],
          datasets: [{
            label: 'Ventes (€)',
            data: [12000, 19000, 15000, 22000, 18000, 25000],
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: true,
              position: 'bottom'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return value.toLocaleString() + ' €';
                }
              }
            }
          }
        }
      });
    }

    // Graphique des achats
    const purchaseCtx = document.getElementById('purchaseChart');
    if (purchaseCtx) {
      const purchaseChart = new Chart(purchaseCtx.getContext('2d'), {
        type: 'line',
        data: {
          labels: ['Août', 'Sept', 'Oct', 'Nov', 'Déc', 'Jan'],
          datasets: [{
            label: 'Achats (€)',
            data: [10000, 14000, 12000, 18000, 15000, 20000],
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: true,
              position: 'bottom'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return value.toLocaleString() + ' €';
                }
              }
            }
          }
        }
      });
    }
  });
</script>
{% endblock %}